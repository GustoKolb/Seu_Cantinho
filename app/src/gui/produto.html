<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="produto.css">
  <title>Seu Cantinho - Espaço</title>
</head>

<body>
  
  <div class="produto-container">
    <div id="galeria">
        <img id="img-principal" class="principal">
        <div id="thumbnails"></div>
    </div>
    
    <div class="info">
        <h1 id="name"></h1>
        <p  id="description"></p>
        <h3 id="address"></h3>
        <h3 id="capacity"></h3>
        <h2 id="price"></h2>
        
        <div class="reserva">
            <h3>Selecionar Período de Locação</h3>
            <div id="selecionar-datas" style="display: flex; align-items: center; gap: 1rem;">
                <input id="start_date" type="date"/><p>→</p><input id="end_date" type="date"/>
            </div>
            <button id="botao_reservar" onclick="reservar()">Confirmar Reserva</button>
        </div>
    </div>
  </div>


</body>

<script>
    const BROKER_URL = "http://localhost:8000"
    const ENDPOINT_LOCAIS = "locais"
    const ENDPOINT_IMAGENS = "imagens"
    const params = new URLSearchParams(window.location.search);
    document.getElementById('name').innerText = params.get("name");
    document.getElementById('address').innerText = params.get("address");
    document.getElementById('description').innerText = params.get("description");
    document.getElementById('price').innerText = `Preço: ${params.get("price")} / Dia`;
    document.getElementById('capacity').innerText = `Capacidade: ${params.get("capacity")} Pessoas`;
    
    const images = params.get("images").split(',')
    images.forEach(async image => {
        const data_b64 = await fetch(`${BROKER_URL}/${ENDPOINT_IMAGENS}/${image}`).then(r=>r.json()).then(j=>j.data);
        const image_block = document.createElement("img");
        image_block.src = "data:image/jpeg;base64," + data_b64;
        image_block.addEventListener('mouseover', ()=>trocarImg(image_block));
        document.getElementById('thumbnails').appendChild(image_block)
        document.getElementById('img-principal').src = document.getElementById('thumbnails').firstChild.src;//usa primeira imagem de principal
    });

    function trocarImg(el) {
        document.getElementById("img-principal").src = el.src;
    }

    function reservar() {
        //verificar date range, se valido
        //fetch POST infos, se sucesso
        //limpar data escrita, atualizar reservas/datas ocupadas
        alert("Reserva Criada Com Sucesso\n(Mentira, Não Implementei Isso Ainda)");
    }
</script>

</html>
